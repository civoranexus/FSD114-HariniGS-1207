{% extends "base.html" %}
{% block title %}
    <title>Admin Dashboard</title>
{% endblock %}
{% block extra_css %}
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 10px;
            border: 1px solid #ccc;
            text-align: center;
        }
        th {
            background: #f4f4f4;
        }
        .badge.green {
            color: green;
            font-weight: bold;
        }
        .badge.gray {
            color: gray;
        }
    </style>
{% endblock %}
{% block content %}
<body>

<p>Total records: {{ students_data|length }}</p>

<h1>Admin Dashboard: Student Progress & Certificates</h1>

{% if students_data %}
<table>
    <thead>
        <tr>
            <th>Student</th>
            <th>Course</th>
            <th>Certificate ID</th>
            <th>Downloaded</th>
            <th>Action</th>
            <th>Issued Date</th>
        </tr>
    </thead>

    <tbody>
        {% for row in students_data %}
        <tr>
            <td>
                {{ row.enrollment.full_name|default:row.enrollment.user.username }}
            </td>

            <td>
                {{ row.enrollment.course.title }}
            </td>

            <td>
                {{ row.verification_code }}
            </td>

            <td>
                {% if row.downloaded %}
                    <span class="badge green">Downloaded</span>
                {% else %}
                    <span class="badge gray">Not Downloaded</span>
                {% endif %}
            </td>

            <td>
                {% if row.revoked %}
                    <a href="{% url 'certificates:reissue_certificate' row.pk %}">
                        Reissue
                    </a>
                {% else %}
                    <a href="{% url 'certificates:revoke_certificate' row.pk %}">
                        Revoke
                    </a>
                {% endif %}
            </td>

            <td>
                {{ row.issued_at|date:"d M Y" }}
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

{% else %}
    <p>No student data available.</p>
{% endif %}

<hr>

<form method="get" class="admin-filters">

    <input type="text"
           name="q"
           placeholder="Search student name..."
           value="{{ query }}">

    <select name="course">
        <option value="">All Courses</option>
        {% for course in courses %}
            <option value="{{ course.id }}">
                {{ course.title }}
            </option>
        {% endfor %}
    </select>

    <select name="downloaded">
        <option value="">Downloaded?</option>
        <option value="true">Downloaded</option>
        <option value="false">Not Downloaded</option>
    </select>

    <select name="revoked">
        <option value="">Status</option>
        <option value="false">Active</option>
        <option value="true">Revoked</option>
    </select>

    <button type="submit">Filter</button>

</form>

</body>
{% endblock %}
